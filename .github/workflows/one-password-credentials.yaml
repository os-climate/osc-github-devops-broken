---
# SPDX-License-Identifier: Apache-2.0
# SPDX-FileCopyrightText: 2024 The Linux Foundation <https://linuxfoundation.org>

name: "ðŸ”‘ 1Password Credential Test"
# Builds a project for any number of specified Python versions"

on:
  workflow_call:
    inputs:
      OP_SERVICE_ACCOUNT_TOKEN:
        # Usually specified/extracted from the file: pyproject.toml
        description: "1Password service account credential"
        required: true
        type: string

jobs:
  one-password-access:
    name: "1Password Credential Test"
    runs-on: "ubuntu-latest"

    steps:
      - name: "Load test secret"
        uses: 1password/load-secrets-action@v2
        with:
          # Export loaded secrets as environment variables
          export-env: true
        env:
          OP_SERVICE_ACCOUNT_TOKEN: ${{ secrets.ONE_PASSWORD_TESTING }}
          # Parameters below are from: "Test Secure Note"
          TEST_NOTE_LABEL: "op://67hdehutbpddhfbgm6ffjvdsbu/Test Secure Note/notesPlain"
          TEST_NOTE_SHA: "op://67hdehutbpddhfbgm6ffjvdsbu/Test Secure Note/add more/sha1sum"

      - name: Print masked secret
        # Prints: Secret: ***
        run: |
          echo "Secret: $TEST_NOTE_LABEL"
          echo "Secret: $TEST_NOTE_SHA"
